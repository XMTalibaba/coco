"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.JwtAuthentication = void 0;

var _authentication_type = require("../authentication_type");

var _routes = require("./routes");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class JwtAuthentication extends _authentication_type.AuthenticationType {
  constructor(config, sessionStorageFactory, router, esClient, coreSetup, logger) {
    var _this$config$jwt;

    super(config, sessionStorageFactory, router, esClient, coreSetup, logger);

    _defineProperty(this, "type", 'jwt');

    _defineProperty(this, "authHeaderName", void 0);

    this.authHeaderName = ((_this$config$jwt = this.config.jwt) === null || _this$config$jwt === void 0 ? void 0 : _this$config$jwt.header.toLowerCase()) || 'authorization';
    this.init();
  }

  async init() {
    const routes = new _routes.JwtAuthRoutes(this.router, this.sessionStorageFactory);
    routes.setupRoutes();
  }

  getTokenFromUrlParam(request) {
    var _this$config$jwt2;

    const urlParamName = (_this$config$jwt2 = this.config.jwt) === null || _this$config$jwt2 === void 0 ? void 0 : _this$config$jwt2.url_param;

    if (urlParamName) {
      const token = request.url.query[urlParamName];
      return token || undefined;
    }

    return undefined;
  }

  getBearerToken(request) {
    const token = this.getTokenFromUrlParam(request);

    if (token) {
      return `Bearer ${token}`;
    } // no token in url parameter, try to get token from header


    return request.headers[this.authHeaderName] || undefined;
  }

  requestIncludesAuthInfo(request) {
    var _this$config$jwt3;

    if (request.headers[this.authHeaderName]) {
      return true;
    }

    const urlParamName = (_this$config$jwt3 = this.config.jwt) === null || _this$config$jwt3 === void 0 ? void 0 : _this$config$jwt3.url_param;

    if (urlParamName && request.url.query[urlParamName]) {
      return true;
    }

    return false;
  }

  getAdditionalAuthHeader(request) {
    const header = {};
    const token = this.getTokenFromUrlParam(request);

    if (token) {
      header[this.authHeaderName] = `Bearer ${token}`;
    }

    return header;
  }

  getCookie(request, authInfo) {
    return {
      username: authInfo.user_name,
      credentials: {
        authHeaderValue: this.getBearerToken(request)
      },
      authType: this.type,
      expiryTime: Date.now() + this.config.session.ttl
    };
  }

  async isValidCookie(cookie) {
    var _cookie$credentials;

    return cookie.authType === this.type && cookie.username && cookie.expiryTime && ((_cookie$credentials = cookie.credentials) === null || _cookie$credentials === void 0 ? void 0 : _cookie$credentials.authHeaderValue);
  }

  handleUnauthedRequest(request, response, toolkit) {
    return response.unauthorized();
  }

  buildAuthHeaderFromCookie(cookie) {
    var _cookie$credentials2;

    const header = {};
    const authHeaderValue = (_cookie$credentials2 = cookie.credentials) === null || _cookie$credentials2 === void 0 ? void 0 : _cookie$credentials2.authHeaderValue;

    if (authHeaderValue) {
      header[this.authHeaderName] = authHeaderValue;
    }

    return header;
  }

}

exports.JwtAuthentication = JwtAuthentication;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImp3dF9hdXRoLnRzIl0sIm5hbWVzIjpbIkp3dEF1dGhlbnRpY2F0aW9uIiwiQXV0aGVudGljYXRpb25UeXBlIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJzZXNzaW9uU3RvcmFnZUZhY3RvcnkiLCJyb3V0ZXIiLCJlc0NsaWVudCIsImNvcmVTZXR1cCIsImxvZ2dlciIsImF1dGhIZWFkZXJOYW1lIiwiand0IiwiaGVhZGVyIiwidG9Mb3dlckNhc2UiLCJpbml0Iiwicm91dGVzIiwiSnd0QXV0aFJvdXRlcyIsInNldHVwUm91dGVzIiwiZ2V0VG9rZW5Gcm9tVXJsUGFyYW0iLCJyZXF1ZXN0IiwidXJsUGFyYW1OYW1lIiwidXJsX3BhcmFtIiwidG9rZW4iLCJ1cmwiLCJxdWVyeSIsInVuZGVmaW5lZCIsImdldEJlYXJlclRva2VuIiwiaGVhZGVycyIsInJlcXVlc3RJbmNsdWRlc0F1dGhJbmZvIiwiZ2V0QWRkaXRpb25hbEF1dGhIZWFkZXIiLCJnZXRDb29raWUiLCJhdXRoSW5mbyIsInVzZXJuYW1lIiwidXNlcl9uYW1lIiwiY3JlZGVudGlhbHMiLCJhdXRoSGVhZGVyVmFsdWUiLCJhdXRoVHlwZSIsInR5cGUiLCJleHBpcnlUaW1lIiwiRGF0ZSIsIm5vdyIsInNlc3Npb24iLCJ0dGwiLCJpc1ZhbGlkQ29va2llIiwiY29va2llIiwiaGFuZGxlVW5hdXRoZWRSZXF1ZXN0IiwicmVzcG9uc2UiLCJ0b29sa2l0IiwidW5hdXRob3JpemVkIiwiYnVpbGRBdXRoSGVhZGVyRnJvbUNvb2tpZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQTZCQTs7QUFDQTs7OztBQUVPLE1BQU1BLGlCQUFOLFNBQWdDQyx1Q0FBaEMsQ0FBbUQ7QUFLeERDLEVBQUFBLFdBQVcsQ0FDVEMsTUFEUyxFQUVUQyxxQkFGUyxFQUdUQyxNQUhTLEVBSVRDLFFBSlMsRUFLVEMsU0FMUyxFQU1UQyxNQU5TLEVBT1Q7QUFBQTs7QUFDQSxVQUFNTCxNQUFOLEVBQWNDLHFCQUFkLEVBQXFDQyxNQUFy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OztBQUVEVSxFQUFBQSxxQkFBcUIsQ0FDbkIxQixPQURtQixFQUVuQjJCLFFBRm1CLEVBR25CQyxPQUhtQixFQUlGO0FBQ2pCLFdBQU9ELFFBQVEsQ0FBQ0UsWUFBVCxFQUFQO0FBQ0Q7O0FBRURDLEVBQUFBLHlCQUF5QixDQUFDTCxNQUFELEVBQXFDO0FBQUE7O0FBQzVELFVBQU1oQyxNQUFXLEdBQUcsRUFBcEI7QUFDQSxVQUFNdUIsZUFBZSwyQkFBR1MsTUFBTSxDQUFDVixXQUFWLHlEQUFHLHFCQUFvQkMsZUFBNUM7O0FBQ0EsUUFBSUEsZUFBSixFQUFxQjtBQUNuQnZCLE1BQUFBLE1BQU0sQ0FBQyxLQUFLRixjQUFOLENBQU4sR0FBOEJ5QixlQUE5QjtBQUNEOztBQUNELFdBQU92QixNQUFQO0FBQ0Q7O0FBekd1RCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgIENvcHlyaWdodCAyMDIwIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogICBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiAgIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogICBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqICAgb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiAgIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiAgIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBQYXJzZWRVcmxRdWVyeSB9IGZyb20gJ3F1ZXJ5c3RyaW5nJztcbmltcG9ydCB7XG4gIFNlc3Npb25TdG9yYWdlRmFjdG9yeSxcbiAgSVJvdXRlcixcbiAgSUxlZ2FjeUNsdXN0ZXJDbGllbnQsXG4gIENvcmVTZXR1cCxcbiAgS2liYW5hUmVxdWVzdCxcbiAgTG9nZ2VyLFxuICBMaWZlY3ljbGVSZXNwb25zZUZhY3RvcnksXG4gIEF1dGhUb29sa2l0LFxuICBJS2liYW5hUmVzcG9uc2UsXG59IGZyb20gJ2tpYmFuYS9zZXJ2ZXInO1xuaW1wb3J0IHsgU2VjdXJpdHlQbHVnaW5Db25maWdUeXBlIH0gZnJvbSAnLi4vLi4vLi4nO1xuaW1wb3J0IHsgU2VjdXJpdHlTZXNzaW9uQ29va2llIH0gZnJvbSAnLi4vLi4vLi4vc2Vzc2lvbi9zZWN1cml0eV9jb29raWUnO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25UeXBlIH0gZnJvbSAnLi4vYXV0aGVudGljYXRpb25fdHlwZSc7XG5pbXBvcnQgeyBKd3RBdXRoUm91dGVzIH0gZnJvbSAnLi9yb3V0ZXMnO1xuXG5leHBvcnQgY2xhc3MgSnd0QXV0aGVudGljYXRpb24gZXh0ZW5kcyBBdXRoZW50aWNhdGlvblR5cGUge1xuICBwdWJsaWMgcmVhZG9ubHkgdHlwZTogc3RyaW5nID0gJ2p3dCc7XG5cbiAgcHJpdmF0ZSBhdXRoSGVhZGVyTmFtZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGNvbmZpZzogU2VjdXJpdHlQbHVnaW5Db25maWdUeXBlLFxuICAgIHNlc3Npb25TdG9yYWdlRmFjdG9yeTogU2Vzc2lvblN0b3JhZ2VGYWN0b3J5PFNlY3VyaXR5U2Vzc2lvbkNvb2tpZT4sXG4gICAgcm91dGVyOiBJUm91dGVyLFxuICAgIGVzQ2xpZW50OiBJTGVnYWN5Q2x1c3RlckNsaWVudCxcbiAgICBjb3JlU2V0dXA6IENvcmVTZXR1cCxcbiAgICBsb2dnZXI6IExvZ2dlclxuICApIHtcbiAgICBzdXBlcihjb25maWcsIHNlc3Npb25TdG9yYWdlRmFjdG9yeSwgcm91dGVyLCBlc0NsaWVudCwgY29yZVNldHVwLCBsb2dnZXIpO1xuICAgIHRoaXMuYXV0aEhlYWRlck5hbWUgPSB0aGlzLmNvbmZpZy5qd3Q/LmhlYWRlci50b0xvd2VyQ2FzZSgpIHx8ICdhdXRob3JpemF0aW9uJztcblxuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0KCkge1xuICAgIGNvbnN0IHJvdXRlcyA9IG5ldyBKd3RBdXRoUm91dGVzKHRoaXMucm91dGVyLCB0aGlzLnNlc3Npb25TdG9yYWdlRmFjdG9yeSk7XG4gICAgcm91dGVzLnNldHVwUm91dGVzKCk7XG4gIH1cblxuICBwcml2YXRlIGdldFRva2VuRnJvbVVybFBhcmFtKHJlcXVlc3Q6IEtpYmFuYVJlcXVlc3QpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHVybFBhcmFtTmFtZSA9IHRoaXMuY29uZmlnLmp3dD8udXJsX3BhcmFtO1xuICAgIGlmICh1cmxQYXJhbU5hbWUpIHtcbiAgICAgIGNvbnN0IHRva2VuID0gKHJlcXVlc3QudXJsLnF1ZXJ5IGFzIFBhcnNlZFVybFF1ZXJ5KVt1cmxQYXJhbU5hbWVdO1xuICAgICAgcmV0dXJuICh0b2tlbiBhcyBzdHJpbmcpIHx8IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QmVhcmVyVG9rZW4ocmVxdWVzdDogS2liYW5hUmVxdWVzdCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuRnJvbVVybFBhcmFtKHJlcXVlc3QpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgcmV0dXJuIGBCZWFyZXIgJHt0b2tlbn1gO1xuICAgIH1cblxuICAgIC8vIG5vIHRva2VuIGluIHVybCBwYXJhbWV0ZXIsIHRyeSB0byBnZXQgdG9rZW4gZnJvbSBoZWFkZXJcbiAgICByZXR1cm4gKHJlcXVlc3QuaGVhZGVyc1t0aGlzLmF1dGhIZWFkZXJOYW1lXSBhcyBzdHJpbmcpIHx8IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByb3RlY3RlZCByZXF1ZXN0SW5jbHVkZXNBdXRoSW5mbyhcbiAgICByZXF1ZXN0OiBLaWJhbmFSZXF1ZXN0PHVua25vd24sIHVua25vd24sIHVua25vd24sIGFueT5cbiAgKTogYm9vbGVhbiB7XG4gICAgaWYgKHJlcXVlc3QuaGVhZGVyc1t0aGlzLmF1dGhIZWFkZXJOYW1lXSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgdXJsUGFyYW1OYW1lID0gdGhpcy5jb25maWcuand0Py51cmxfcGFyYW07XG4gICAgaWYgKHVybFBhcmFtTmFtZSAmJiAocmVxdWVzdC51cmwucXVlcnkgYXMgUGFyc2VkVXJsUXVlcnkpW3VybFBhcmFtTmFtZV0pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBZGRpdGlvbmFsQXV0aEhlYWRlcihyZXF1ZXN0OiBLaWJhbmFSZXF1ZXN0PHVua25vd24sIHVua25vd24sIHVua25vd24sIGFueT4pIHtcbiAgICBjb25zdCBoZWFkZXI6IGFueSA9IHt9O1xuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZXRUb2tlbkZyb21VcmxQYXJhbShyZXF1ZXN0KTtcbiAgICBpZiAodG9rZW4pIHtcbiAgICAgIGhlYWRlclt0aGlzLmF1dGhIZWFkZXJOYW1lXSA9IGBCZWFyZXIgJHt0b2tlbn1gO1xuICAgIH1cbiAgICByZXR1cm4gaGVhZGVyO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvb2tpZShcbiAgICByZXF1ZXN0OiBLaWJhbmFSZXF1ZXN0PHVua25vd24sIHVua25vd24sIHVua25vd24sIGFueT4sXG4gICAgYXV0aEluZm86IGFueVxuICApOiBTZWN1cml0eVNlc3Npb25Db29raWUge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VybmFtZTogYXV0aEluZm8udXNlcl9uYW1lLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgYXV0aEhlYWRlclZhbHVlOiB0aGlzLmdldEJlYXJlclRva2VuKHJlcXVlc3QpLFxuICAgICAgfSxcbiAgICAgIGF1dGhUeXBlOiB0aGlzLnR5cGUsXG4gICAgICBleHBpcnlUaW1lOiBEYXRlLm5vdygpICsgdGhpcy5jb25maWcuc2Vzc2lvbi50dGwsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGlzVmFsaWRDb29raWUoY29va2llOiBTZWN1cml0eVNlc3Npb25Db29raWUpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gKFxuICAgICAgY29va2llLmF1dGhUeXBlID09PSB0aGlzLnR5cGUgJiZcbiAgICAgIGNvb2tpZS51c2VybmFtZSAmJlxuICAgICAgY29va2llLmV4cGlyeVRpbWUgJiZcbiAgICAgIGNvb2tpZS5jcmVkZW50aWFscz8uYXV0aEhlYWRlclZhbHVlXG4gICAgKTtcbiAgfVxuXG4gIGhhbmRsZVVuYXV0aGVkUmVxdWVzdChcbiAgICByZXF1ZXN0OiBLaWJhbmFSZXF1ZXN0LFxuICAgIHJlc3BvbnNlOiBMaWZlY3ljbGVSZXNwb25zZUZhY3RvcnksXG4gICAgdG9vbGtpdDogQXV0aFRvb2xraXRcbiAgKTogSUtpYmFuYVJlc3BvbnNlIHtcbiAgICByZXR1cm4gcmVzcG9uc2UudW5hdXRob3JpemVkKCk7XG4gIH1cblxuICBidWlsZEF1dGhIZWFkZXJGcm9tQ29va2llKGNvb2tpZTogU2VjdXJpdHlTZXNzaW9uQ29va2llKTogYW55IHtcbiAgICBjb25zdCBoZWFkZXI6IGFueSA9IHt9O1xuICAgIGNvbnN0IGF1dGhIZWFkZXJWYWx1ZSA9IGNvb2tpZS5jcmVkZW50aWFscz8uYXV0aEhlYWRlclZhbHVlO1xuICAgIGlmIChhdXRoSGVhZGVyVmFsdWUpIHtcbiAgICAgIGhlYWRlclt0aGlzLmF1dGhIZWFkZXJOYW1lXSA9IGF1dGhIZWFkZXJWYWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGhlYWRlcjtcbiAgfVxufVxuIl19